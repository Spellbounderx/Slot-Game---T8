using UnityEngine;

public class GameManager : MonoBehaviour
{
    [SerializeField] private int boardHeight = 3;
    [SerializeField] private int boardWidth = 3;
    [SerializeField] private GameObject[] gamePieces;

    private GameObject _board;
    private GameObject[,] _gameBoard;
    private Vector3 _offset = new Vector3(0, 0, -1);

    void Start()
    {
        // Find the GameBoard object
        _board = GameObject.Find("GameBoard");
        if (_board == null)
        {
            Debug.LogError("GameBoard object not found in the scene!");
            return;
        }

        // Initialize the array
        _gameBoard = new GameObject[boardHeight, boardWidth];

        // Spawn the initial set of icons
        Spin();
    }

    // This method can be called anytime to "spin" the slot machine
    public void Spin()
    {
        for (int i = 0; i < boardHeight; i++)
        {
            for (int j = 0; j < boardWidth; j++)
            {
                // Destroy the old piece if it exists
                if (_gameBoard[i, j] != null)
                {
                    Destroy(_gameBoard[i, j]);
                }

                // Find the slot GameObject
                Transform gridTransform = _board.transform.Find(i + "," + j); // Ensure slots are named like "0,0", "0,1", etc.
                if (gridTransform == null)
                {
                    Debug.LogWarning($"Slot {i},{j} not found under GameBoard!");
                    continue;
                }

                // Pick a random piece
                GameObject pieceType = gamePieces[Random.Range(0, gamePieces.Length)];

                // Instantiate the piece and parent it to the slot
                GameObject thisPiece = Instantiate(pieceType, gridTransform.position + _offset, Quaternion.identity, gridTransform);
                thisPiece.name = pieceType.name;

                // Save the piece in the array
                _gameBoard[i, j] = thisPiece;
            }
        }
    }
}
